diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/configure.in freetds-0.63/configure.in
--- freetds-0.63-orig/configure.in	2005-03-29 18:42:21.000000000 -0600
+++ freetds-0.63/configure.in	2005-11-14 12:24:12.281250000 -0600
@@ -350,6 +350,21 @@
 	odbc=true
 fi
 
+AC_ARG_WITH(odbc32,
+AC_HELP_STRING([--with-odbc32=DIR], [build odbc driver against ODBC32 in DIR]))
+if test "$with_odbc32"; then
+	if echo "$with_odbc32" | grep -v '^/'; then
+		with_unixodbc="$PWD/$with_unixodbc"
+	fi
+	CPPFLAGS="$CPPFLAGS -DUNIXODBC"
+	ODBC_INC="-I$with_unixodbc/include"
+	LDFLAGS="$LDFLAGS -L$with_unixodbc/lib"
+	ODBCLIB="-lodbc32"
+	odbc=true
+	unixodbc=true
+	odbc32=true
+fi
+
 build_odbc=yes
 if test "$odbc" != "true"; then
 AC_ARG_ENABLE(odbc,
@@ -370,12 +385,22 @@
 		[AC_CHECK_LIB(odbc, SQLConnect, [AC_CHECK_HEADER([sql.h], [odbc=true
 	unixodbc=true
 	CPPFLAGS="$CPPFLAGS -DUNIXODBC"
-	ODBCLIB="-lodbc"])] )] )
+	ODBCLIB="-lodbc"])],
+		[AC_CHECK_LIB(odbc32, SQLConnect, [AC_CHECK_HEADER([sql.h], [odbc=true
+	unixodbc=true
+	odbc32=true
+	CPPFLAGS="$CPPFLAGS -DUNIXODBC"
+	ODBCLIB="-lodbc32"], ,[#include <windows.h>])], ,[-Wl,--enable-runtime-pseudo-reloc])] )] )
 	fi
 	if test "$odbc" = "true"; then
 		if test "$unixodbc" = "true"; then
-			AC_CHECK_LIB(odbcinst, SQLGetPrivateProfileString, [ODBCINSTLIB="-lodbcinst"
+			if test "$odbc32" = "true"; then
+				ODBCINSTLIB="-lodbccp32"
+				AC_DEFINE_UNQUOTED(HAVE_SQLGETPRIVATEPROFILESTRING, 1, [Define to 1 if you have the SQLGetPrivateProfileString function.])
+			else
+				AC_CHECK_LIB(odbcinst, SQLGetPrivateProfileString, [ODBCINSTLIB="-lodbcinst"
 	AC_DEFINE_UNQUOTED(HAVE_SQLGETPRIVATEPROFILESTRING, 1, [Define to 1 if you have the SQLGetPrivateProfileString function.])])
+			fi
 		elif test "$iodbc" = "true"; then
 			AC_CHECK_LIB(iodbcinst, SQLGetPrivateProfileString, [ODBCINSTLIB="-liodbcinst"
 	AC_DEFINE_UNQUOTED(HAVE_SQLGETPRIVATEPROFILESTRING, 1, [Define to 1 if you have the SQLGetPrivateProfileString function.])])
@@ -393,9 +418,14 @@
 	AC_TRY_COMPILE([#include <sqltypes.h>], [SQLLEN len = 123;],
 		AC_DEFINE(HAVE_SQLLEN, 1, [Define if sqltypes.h define SQLLEN])
 		# check SQLColAttribute definition
-		AC_TRY_COMPILE([#include <sqltypes.h>
+		AC_TRY_COMPILE([
+#ifdef __CYGWIN__
+#define WIN32_LEAN_AND_MEAN
+#include <windows.h>
+#endif
 #include <sql.h>
 #include <sqlext.h>
+#include <sqltypes.h>
 
 SQLRETURN  SQL_API SQLColAttribute (SQLHSTMT StatementHandle,
 	SQLUSMALLINT ColumnNumber, SQLUSMALLINT FieldIdentifier,
@@ -411,6 +441,7 @@
 
 AM_CONDITIONAL(ODBC, test "$odbc" = "true")
 AM_CONDITIONAL(UNIXODBC, test "$unixodbc" = "true")
+AM_CONDITIONAL(ODBC32, test "$odbc32" = "true")
 AC_SUBST(ODBC)
 AC_SUBST(ODBC_INC)
 AC_SUBST(ODBCLIB)
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/include/tdsodbc.h freetds-0.63/include/tdsodbc.h
--- freetds-0.63-orig/include/tdsodbc.h	2004-10-28 07:42:12.000000000 -0500
+++ freetds-0.63/include/tdsodbc.h	2005-11-13 19:45:15.359375000 -0600
@@ -23,6 +23,10 @@
 #include <tds.h>
 
 #ifdef UNIXODBC
+#ifdef __CYGWIN__
+#define WIN32_LEAN_AND_MEAN
+#include <windows.h>
+#endif
 #include <sql.h>
 #include <sqlext.h>
 #include <odbcinst.h>
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/ctlib/Makefile.am freetds-0.63/src/ctlib/Makefile.am
--- freetds-0.63-orig/src/ctlib/Makefile.am	2004-12-09 06:54:43.000000000 -0600
+++ freetds-0.63/src/ctlib/Makefile.am	2005-11-13 18:34:39.765625000 -0600
@@ -6,7 +6,7 @@
 
 # version bumped for 0.63, I hope we'll bump it less in the future -- freddy77
 ##libct_la_LDFLAGS=	-version-info 3:0:0 -export-symbols-regex '^(cs_|ct_|blk_).*' -Wl,-Bsymbolic
-libct_la_LDFLAGS=	-version-info 3:0:0 -export-symbols-regex '^(cs_|ct_|blk_).*' $(FREETDS_SYMBOLIC)
+libct_la_LDFLAGS=	-version-info 3:0:0 -export-symbols-regex '^(cs_|ct_|blk_).*' $(FREETDS_SYMBOLIC) -no-undefined
 
 libct_la_LIBADD	=	../tds/libtds_objects.la ../replacements/libreplacements.la $(NETWORK_LIBS) $(LIBICONV) $(FREETDS_LIBGCC)
 
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/dblib/Makefile.am freetds-0.63/src/dblib/Makefile.am
--- freetds-0.63-orig/src/dblib/Makefile.am	2004-12-09 06:54:45.000000000 -0600
+++ freetds-0.63/src/dblib/Makefile.am	2005-11-13 18:36:21.015625000 -0600
@@ -8,7 +8,7 @@
 EXTRA_DIST	=	dbopen.c
 libsybdb_la_SOURCES=	dblib.c dbutil.c rpc.c bcp.c xact.c $(DBOPEN)
 # version bumped for 0.63, I hope we'll bump it less in the future -- freddy77
-libsybdb_la_LDFLAGS=	-version-info 5:0:0 -export-symbols-regex '^(db|bcp_|tdsdump_open|tdsdbopen|.*_xact|close_commit|open_commit|.?asprintf).*' $(FREETDS_SYMBOLIC)
+libsybdb_la_LDFLAGS=	-version-info 5:0:0 -export-symbols-regex '^(db|bcp_|tdsdump_open|tdsdbopen|.*_xact|close_commit|open_commit|.?asprintf).*' $(FREETDS_SYMBOLIC) -no-undefined
 ##libsybdb_la_LDFLAGS=	-version-info 5:0:0 -export-symbols-regex '^(db|bcp_|tdsdump_open|tdsdbopen|.*_xact|close_commit|open_commit).*' -Wl,-Bsymbolic
 libsybdb_la_LIBADD=	../tds/libtds_objects.la ../replacements/libreplacements.la $(NETWORK_LIBS) $(LIBICONV) $(FREETDS_LIBGCC)
 
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/odbc/Makefile.am freetds-0.63/src/odbc/Makefile.am
--- freetds-0.63-orig/src/odbc/Makefile.am	2004-12-09 06:54:46.000000000 -0600
+++ freetds-0.63/src/odbc/Makefile.am	2005-11-14 13:20:54.359375000 -0600
@@ -1,7 +1,8 @@
 # $Id: freetds-0.63-1.patch,v 1.2 2008-05-15 21:10:57 yselkowitz Exp $
 SUBDIRS		= unittests
 
-lib_LTLIBRARIES	=	libtdsodbc.la
+odbcdir = $(libdir)/odbc
+odbc_LTLIBRARIES	=	libtdsodbc.la
 ##EXTRA_LTLIBRARIES	=	libtdsodbc.la
 libtdsodbc_la_SOURCES=	odbc.c connectparams.c convert_tds2sql.c \
 	descriptor.c prepare_query.c odbc_util.c \
@@ -12,7 +13,7 @@
 libtdsodbc_la_LIBADD=	../tds/libtds_objects.la ../replacements/libreplacements.la $(ODBCINSTLIB) $(NETWORK_LIBS) $(LIBICONV) $(FREETDS_LIBGCC)
 INCLUDES	=	-I$(top_srcdir)/include $(ODBC_INC)
 # -module is needed by Darwin (Mac OS X)
-libtdsodbc_la_LDFLAGS = -export-symbols-regex '^(SQL|ODBCINST).*' $(FREETDS_SYMBOLIC) -module
+libtdsodbc_la_LDFLAGS = -export-symbols-regex '^(SQL|ODBCINST).*' $(FREETDS_SYMBOLIC) -module -avoid-version -no-undefined
 
 ## Need blank statement to avoid compiling odbc.c
 odbc: $(EXTRA_LTLIBRARIES)
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/odbc/odbc.c freetds-0.63/src/odbc/odbc.c
--- freetds-0.63-orig/src/odbc/odbc.c	2004-10-28 07:42:12.000000000 -0500
+++ freetds-0.63/src/odbc/odbc.c	2005-11-14 12:51:27.593750000 -0600
@@ -358,7 +358,7 @@
 
 	/* add login info */
 	if (hwnd) {
-#ifdef WIN32
+#if defined(WIN32) && !defined(__CYGWIN__)
 		/* prompt for login information */
 		if (!get_login_info(hwnd, connection)) {
 			tds_free_connection(connection);
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/replacements/vasprintf.c freetds-0.63/src/replacements/vasprintf.c
--- freetds-0.63-orig/src/replacements/vasprintf.c	2004-03-15 03:15:44.000000000 -0600
+++ freetds-0.63/src/replacements/vasprintf.c	2005-11-14 12:53:04.953125000 -0600
@@ -84,9 +84,9 @@
 
 #ifdef _REENTRANT
 
-# ifdef WIN32
+#if defined(WIN32) && !defined(__CYGWIN__)
 #  error Win32 do not have /dev/null, should use vsnprintf version
-# endif
+#endif
 
 	if ((fp = fopen(_PATH_DEVNULL, "w")) == NULL)
 		return -1;
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/server/Makefile.am freetds-0.63/src/server/Makefile.am
--- freetds-0.63-orig/src/server/Makefile.am	2004-12-12 18:15:08.000000000 -0600
+++ freetds-0.63/src/server/Makefile.am	2005-11-13 18:37:43.203125000 -0600
@@ -2,7 +2,7 @@
 lib_LTLIBRARIES	=	libtdssrv.la
 libtdssrv_la_SOURCES=	query.c server.c login.c
 # bump server version whenever bumping libtds version
-libtdssrv_la_LDFLAGS=	-version-info 2:0:0
+libtdssrv_la_LDFLAGS=	-version-info 2:0:0 -no-undefined
 libtdssrv_la_LIBADD =	../tds/libtds_objects.la ../replacements/libreplacements.la $(NETWORK_LIBS) $(LIBICONV) $(FREETDS_LIBGCC)
 INCLUDES	=	-I$(top_srcdir)/include
 noinst_PROGRAMS	= tdssrv
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/tds/Makefile.am freetds-0.63/src/tds/Makefile.am
--- freetds-0.63-orig/src/tds/Makefile.am	2004-12-12 18:19:05.000000000 -0600
+++ freetds-0.63/src/tds/Makefile.am	2005-11-13 18:38:00.921875000 -0600
@@ -14,7 +14,7 @@
 lib_LTLIBRARIES		=	libtds.la
 libtds_la_SOURCES	=
 # Release 0.63 is version 4, cf. ML 30 Nov 2004 11:08:28 -0600
-libtds_la_LDFLAGS	= -version-info 4:0:0 -export-symbols-regex '^(tds_|tdsdump_|tds5_|tds7_).*'
+libtds_la_LDFLAGS	= -version-info 4:0:0 -export-symbols-regex '^(tds_|tdsdump_|tds5_|tds7_).*' -no-undefined
 # 			bump server version whenever bumping libtds version
 libtds_la_LIBADD 	= libtds_objects.la ../replacements/libreplacements.la $(NETWORK_LIBS) $(LIBICONV) $(FREETDS_LIBGCC)
 noinst_HEADERS		= tds_willconvert.h character_sets.h \
diff -urN -x .build -x .inst -x .sinst -x configure -x 'Makefile.in*' -x 'aclocal.m4*' -x ltmain.sh -x 'config.*' -x depcomp -x install-sh -x missing -x 'mkinstalldirs*' -x autom4te.cache -x '*compile' freetds-0.63-orig/src/tds/threadsafe.c freetds-0.63/src/tds/threadsafe.c
--- freetds-0.63-orig/src/tds/threadsafe.c	2004-05-03 15:02:47.000000000 -0500
+++ freetds-0.63/src/tds/threadsafe.c	2005-11-14 12:53:32.890625000 -0600
@@ -68,7 +68,7 @@
 #include <netinet/in.h>
 #endif /* HAVE_NETINET_IN_H */
 
-#ifdef WIN32
+#if defined(WIN32) && !defined(__CYGWIN__)
 #include <shlobj.h>
 #endif
 
